<!-- admin.html -->

<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Admin Panel</title>
  </head>
  <body>
    <h1>Admin Panel</h1>

    <!-- Login Section -->
    <div id="loginSection">
      <h2>Login</h2>
      <form id="loginForm">
        <label for="username">Username:</label>
        <input type="text" id="username" name="username" required />
        <br />
        <label for="password">Password:</label>
        <input type="password" id="password" name="password" required />
        <br />
        <button type="button" onclick="login()">Login</button>
      </form>
    </div>

    <!-- Photo Upload Section (Visible after login) -->
    <div id="photoUploadSection" style="display: none">
      <h2>Upload Photos</h2>
      <form id="uploadForm">
        <input type="file" id="photoInput" accept="image/*" multiple />
        <button type="button" onclick="uploadPhotos()">Upload</button>
      </form>
      <div id="status"></div>
    </div>

    <script>
      async function login() {
        const username = document.getElementById("username").value;
        const password = document.getElementById("password").value;

        try {
          const response = await fetch("/.netlify/functions/login", {
            method: "POST",
            headers: {
              "Content-Type": "application/json",
            },
            body: JSON.stringify({ username, password }),
          });

          const data = await response.json();

          if (response.ok) {
            document.getElementById("loginSection").style.display = "none";
            document.getElementById("photoUploadSection").style.display =
              "block";
          } else {
            alert(data.message);
          }
        } catch (error) {
          console.error("Error during login:", error);
          alert("An error occurred during login.");
        }
      }

      function uploadPhotos() {
        // netlify/functions/upload-photos.js

        const { parse } = require("querystring");

        exports.handler = async function (event, context) {
          try {
            if (event.httpMethod !== "POST") {
              return { statusCode: 405, body: "Method Not Allowed" };
            }

            const body = await parseBody(event);
            const photos = event.isBase64Encoded
              ? Buffer.from(body, "base64")
              : body;

            // Here, you would typically store the photos (e.g., in a cloud storage service).
            // For simplicity, we're just logging the file names in this example.
            const fileNames = photos.map((photo) => photo.originalname);

            return {
              statusCode: 200,
              body: JSON.stringify({
                message: `Uploaded ${fileNames.length} photos: ${fileNames.join(
                  ", "
                )}`,
              }),
            };
          } catch (error) {
            console.error("Error handling request:", error);
            return { statusCode: 500, body: "Internal Server Error" };
          }
        };

        async function parseBody(event) {
          return new Promise((resolve, reject) => {
            let body = "";
            event.on("data", (chunk) => {
              body += chunk;
            });
            event.on("end", () => {
              resolve(parse(body));
            });
            event.on("error", (error) => {
              reject(error);
            });
          });
        }
      }
    </script>
  </body>
</html>
